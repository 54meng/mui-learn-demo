<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>主题日报</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
		<link rel="stylesheet" type="text/css" href="../css/imgload.css" />
		<style>
			.wrapper {
				padding: 30px 10px 0;
			}
			
			.description {
				position: absolute;
				left: 20px;
				bottom: 20px;
				padding-right: 20px;
				font-size: 18px;
				color: #fff;
			}
		</style>
	</head>

	<body>
		<div id="theme">
			<app-nav>
				<!--使用插槽分发内容-->
				<span class="iconfont icon-menu" slot="left" @click="openMenu"></span>
				<span class="title" slot="left">{{theme_data.name}}</span>
			</app-nav>

			<app-banner class="banner" :onerror="load_error" :style="{background:'#3e3e3e'}">
				<p class="description">{{theme_data.description}}</p>
			</app-banner>
			<div class="wrapper">
				<app-list :message="item" :loadimg="'../img/translate.png'" v-for="(item,index) in theme_data.stories" @click.native="openDetails($event,item.id,index)"></app-list>
			</div>
		</div>
		<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/md5.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/imgload.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var vm = new Vue({
				el: "#theme",
				data: {
					theme_data: ''
				},
				created() {
					//记录初始值，用于清空数据
					this.defaultData = JSON.parse(JSON.stringify(this.$data));
				},
				methods: {
					reset_data: function() {
						//延迟清空数据，避免瞬间白屏
						setTimeout(function() {
							vm.$data = Object.assign(vm.$data, vm.defaultData);
							window.scrollTo(0, 0); //重置滚动条位置
						}, 300)
					},
					load_error: function(event) {
						event.target.style.background = "#3e3e3e";
					},
					openMenu: function() {
						mui.openWindow({
							id: 'menu',
							extras: {},
							show: {
								aniShow: 'slide-in-left', //页面显示动画，默认为”slide-in-right“；
								duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
							}
						})
					},
					openDetails: function(event,id) {
						//日报标题
						var title = event.target.innerText;
						//获得详情页面
						var detailPage = plus.webview.getWebviewById('detail');
						//打开详情页面          
						mui.openWindow({
							id: 'detail',
							show: {
								aniShow: 'pop-in', //页面显示动画，默认为”slide-in-right“；
								duration: 280 //页面动画持续时间
							}
						});
						//触发自定义事件，传递参数
						mui.fire(detailPage, 'open_detail', {
							id: id,
							title: title
						});
					}
				}
			})
			mui.init({
				beforeback: function() {
					vm.reset_data();
					return true;
				}
			});
			//自定义事件
			document.addEventListener('themeId', function(event) {
				var theme_id = event.detail.id;
				getThemeList(theme_id, getThemeList)
			});

			//获取日报主题列表
			function getThemeList(id) {
				mui.ajax('https://news-at.zhihu.com/api/4/theme/' + id, {
					type: 'GET',
					dataType: 'json',
					timeout: 5000,
					success: function(rsp) {
						renderList(rsp)
					},
					error: function(xhr, type, errorThrown) {
						//弹出系统提示窗
						mui.toast('获取内容失败');
					}
				});
			}
			//成功回调
			function renderList(rsp) {
				vm.theme_data = rsp;
			}
		</script>
	</body>

</html>